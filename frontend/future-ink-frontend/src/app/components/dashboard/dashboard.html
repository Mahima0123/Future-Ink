<div class="dashboard">
  <!-- TOP NAVBAR -->
  <div class="topbar">

    <div class="logo">Future Ink</div>

    <div class="user-menu">

      <button class="view-btn"
              (click)="openUnlockedLetters()">
        View Unlocked Letters
      </button>

      <div class="avatar" (click)="toggleMenu()">ðŸ‘¤</div>

      <div class="dropdown" *ngIf="menuOpen">
        <button (click)="logout()">Logout</button>
      </div>

    </div>

  </div>
  <div class="content">
    <p class="subtitle">Write today. Read tomorrow.</p>

    <!-- LETTER FORM -->
    <div class="glass-card">
      <h2>New Letter</h2>

      <form (ngSubmit)="submitLetter()" #letterForm="ngForm">

        <input
          type="text"
          placeholder="Letter title"
          [(ngModel)]="newLetter.title"
          name="title"
          required
        />

        <textarea
          placeholder="Write something meaningful..."
          [(ngModel)]="newLetter.body"
          name="body"
          rows="5"
          required
        ></textarea>

        <input
          type="datetime-local"
          [(ngModel)]="newLetter.unlock_at"
          name="unlock_at"
          required
        />

        <button type="submit" [disabled]="letterForm.invalid">
          Save Letter
        </button>

      </form>

      <div *ngIf="successMessage" class="success">
        âœ“ Letter saved to the future
      </div>
    </div>

    <!-- LETTERS -->
    <div class="modal-overlay" *ngIf="showUnlockedModal">

      <div class="modal-card">

        <div class="modal-header">
          <h2>Unlocked Letters âœ¨</h2>
          <button class="close-btn"
                  (click)="closeUnlockedLetters()">âœ•</button>
        </div>

        <div class="modal-content">

          <div *ngFor="let letter of letters" class="letter-card">

          <div (click)="openReflection(letter)" class="letter-preview">
            <h3>{{ letter.title }}</h3>
            <p>{{ letter.body }}</p>
            <span>{{ letter.unlock_at | date:'medium' }}</span>
          </div>

        <!-- REFLECTION PANEL -->
        <div class="reflection-panel"
            *ngIf="selectedLetterId === letter.id">

          <h4>Your Reflection âœ¨</h4>

          <textarea
            [(ngModel)]="reflectionText"
            placeholder="How do you feel reading this now?"
            rows="4">
          </textarea>

          <select [(ngModel)]="selectedMood">
            <option value="">Select mood</option>
            <option>Happy</option>
            <option>Nostalgic</option>
            <option>Proud</option>
            <option>Emotional</option>
            <option>Grateful</option>
            <option>Surprised</option>
          </select>

          <div class="reflection-actions">
            <button (click)="saveReflection(letter)">Save</button>
            <button class="cancel" (click)="closeReflection()">Cancel</button>
          </div>

        </div>

      </div>

          <p *ngIf="letters.length === 0" class="empty">
            No letters unlocked yet ðŸŒ™
          </p>

        </div>

      </div>

    </div>

  </div>

</div>
